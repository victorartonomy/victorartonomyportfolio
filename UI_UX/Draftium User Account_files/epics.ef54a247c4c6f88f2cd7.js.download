(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{1270:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchOrgFulfilledAction=t.fetchOrgAction=t.FETCH_ORGANIZATION=void 0;var n=r(446),a=t.FETCH_ORGANIZATION="FETCH_ORGANIZATION";t.fetchOrgAction=function(e){return{type:a,payload:e}},t.fetchOrgFulfilledAction=function(e){return{type:(0,n.withFulfilledType)(a),payload:e}}},1688:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.checkPageAndRedirectHome=t.getNewHomepage=void 0;var n=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,a=!1,o=void 0;try{for(var i,c=e[Symbol.iterator]();!(n=(i=c.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{!n&&c.return&&c.return()}finally{if(a)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=r(722),o=r(412),i=r(413),c=t.getNewHomepage=e.pipe(e.entries,e.filter(function(e){return!n(e,2)[1].websiteApplication}),e.filter(function(e){return!n(e,2)[1].metadata.parentId}),e.sortBy(function(e){return n(e,2)[1].sortOrder||0}),e.head);t.checkPageAndRedirectHome=function(t,r){var u=t.websiteId,s=t.pages,p=t.location,l=(0,o.getCurrentPage)(r.getState());if(!Object.keys(s).includes(l)){var d=e.findKey(function(e){return e.metadata.homepage},s)||e.flow(c,e.get("0"))(s),f=p.pathname.match(/\/editor\/(website|structure|comment)\/(.+)/);if(f){var v=n(f,2)[1],g=(0,i.getLanguageFromPath)(),h=g?"/"+g:"";return(0,a.replace)(h+"/editor/"+v+"/"+u+"/"+d+(p.search||""))}return null}}}).call(this,r(380))},2779:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.epics=void 0;var n=r(921),a=T(r(6617)),o=r(6618),i=r(6619),c=r(6620),u=r(6633),s=r(6646),p=r(6648),l=r(6649),d=r(6650),f=r(6651),v=r(6652),g=r(6654),h=r(6655),m=r(6656),y=r(6657),E=T(r(6658)),b=T(r(2271));function T(e){return e&&e.__esModule?e:{default:e}}var O=t.epics={editorStatusEpic:m.editorStatusEpic,undoRedoEpic:f.undoRedoEpic,externalUpdateUndo:f.externalUpdateUndo,permissionEpic:o.permissionEpic,changeLocationEpic:i.changeLocationEpic,blocksEpic:u.blocksEpic,pagesEpic:c.pagesEpic,uiKitEpic:s.uiKitEpic,fetchBlockTemplatesEpic:p.fetchBlockTemplatesEpic,fetchViewsEpic:l.fetchViewsEpic,fetchWebsiteEpic:d.fetchWebsiteEpic,fetchOrganizationEpic:y.fetchOrganizationEpic,updateWebsiteEpic:d.updateWebsiteEpic,themesEpic:v.themesEpic,modalsEpic:g.modalsEpic,commentsEpic:h.commentsEpic,getWebsiteAppsEpic:d.getWebsiteAppsEpic,popupsEpic:a.default,popupTemplatesEpic:E.default,ecommerceEpic:b.default};t.default=n.combineEpics.apply(void 0,function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(Object.values(O)))},2780:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=t.PRE_CHANGE_LOCATION="PRE_CHANGE_LOCATION";t.preChangeLocationAction=function(e){return{type:n,payload:e}}},2781:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.getAverageSortOrder=t.SORT_POSITION_BOTTOM=t.SORT_POSITION_TOP=void 0;var n=r(1238);t.SORT_POSITION_TOP="top",t.SORT_POSITION_BOTTOM="bottom",t.getAverageSortOrder=function(t){var r=t.blocks,a=t.position,o=(0,n.sortBlocks)(r);if(!o.length)return 1;if(a>=o.length)return e.pipe(e.last,e.prop(e.__,r),e.prop("sortOrder"),e.add(1))(o);var i=o[a],c=o[a-1];return e.flow(e.compact,e.map(function(e){return r[e].sortOrder}),e.sum)([i,c])/2}}).call(this,r(380))},6617:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.closePopupEditorEpic=t.fetchPopupEpic=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=r(966),o=r(399),i=r(1625),c=r(459),u=r(418);var s=t.fetchPopupEpic=function(t,r){return t.ofType(a.FETCH_POPUP).switchMap((s=regeneratorRuntime.mark(function e(t){var r,u,s,p;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.payload,e.next=3,(0,o.getBlockData)(r);case 3:return u=e.sent,s=n({},u,{id:r,roles:u.roles||[]}),e.next=7,(0,i.buildBlockData)(r,s);case 7:return p=e.sent,e.next=10,(0,i.getAndSetView)(s);case 10:return e.abrupt("return",[(0,c.fetchBlocksFulfilledAction)((l={},d=r,f=p,d in l?Object.defineProperty(l,d,{value:f,enumerable:!0,configurable:!0,writable:!0}):l[d]=f,l)),(0,a.fetchPopupFulfilledAction)(p)]);case 11:case"end":return e.stop()}var l,d,f},e,void 0)}),p=function(){var e=s.apply(this,arguments);return new Promise(function(t,r){return function n(a,o){try{var i=e[a](o),c=i.value}catch(e){return void r(e)}if(!i.done)return Promise.resolve(c).then(function(e){n("next",e)},function(e){n("throw",e)});t(c)}("next")})},function(e){return p.apply(this,arguments)})).switchMap(e.apply(u.Observable.of));var s,p},p=t.closePopupEditorEpic=function(e,t){return e.ofType(a.CLOSE_POPUP_EDITOR).switchMap(function(){var e=t.getState().popups,r=Object.keys(e);return[(0,a.closePopupEditorFulfilledAction)(r)]})};t.default=function(e,t){return u.Observable.merge(s(e,t),p(e,t))}}).call(this,r(380))},6618:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.permissionEpic=void 0;var n=r(722),a=r(446),o=[n.LOCATION_CHANGE,n.CALL_HISTORY_METHOD];t.permissionEpic=function(e){return e.filter(function(e){return!(0,a.hasPermission)(e.type)&&!o.includes(e.type)}).map(a.withPermission)}},6619:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.changeLocationEpic=void 0;var n=r(418),a=r(722),o=r(555),i=r(494),c=r(611),u=r(2780),s=r(459),p=r(446),l=r(413),d=r(1342);t.changeLocationEpic=function(t,r){return n.Observable.merge(t.ofType(a.LOCATION_CHANGE).filter(function(t){var n=t.payload.location.pathname,a=void 0===n?"":n,o=r.getState().pages;return!e.isEmpty(o)&&!a.includes("/editor/")}).switchMap(function(){return n.Observable.merge(n.Observable.of((0,c.closeAllModalsAction)()),n.Observable.of((0,i.unReadyPageAction)()),n.Observable.of((0,o.cleanWebsiteAction)()),n.Observable.of((0,s.cleanBlocksAction)()))}),t.ofType(a.LOCATION_CHANGE,"START").filter(function(){return r.getState().auth}).map(function(){return function(t){var r=e.getOr(null,["router","location","pathname"],t),n=r.match(l.LANG_URL_REGEXP),a=n&&e.includes(n[1],d.ACCOUNT_LANGUAGES)?n[1]:null,o=a?"/"+a+"/":"/editor";if(e.startsWith(o,r)){var i=r.split("/");return a?i[4]:i[3]}return null}(r.getState())}).distinctUntilChanged().switchMap(function(c){return n.Observable.merge(n.Observable.of((0,o.fetchWebsiteAction)(c)),t.ofType((0,p.withPermissionType)((0,p.withFulfilledType)(i.FETCH_PAGES))).switchMap(function(){return n.Observable.merge(n.Observable.of(null),t.ofType(a.LOCATION_CHANGE))}).map(function(){var t=e.get("router.location.pathname")(r.getState());return e.last(t.split("/"))}).distinctUntilChanged().filter(function(e){return r.getState().pages[e]}).map(s.fetchBlocksAction))}),t.ofType(u.PRE_CHANGE_LOCATION).switchMap(function(e){var r=e.payload,o=r.path,c=r.onPageReadyAction;return n.Observable.merge(n.Observable.of((0,a.push)(o)),t.ofType((0,p.withPermissionType)(i.READY_PAGE)).take(1).map(function(){return c}))}))}}).call(this,r(380))},6620:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.pagesEpic=void 0;var n=r(921),a=r(6621),o=r(6622),i=r(6623),c=r(6626),u=r(6627),s=r(6628),p=r(6629),l=r(6631);t.pagesEpic=(0,n.combineEpics)(a.fetchPagesEpic,i.createPageEpic,l.clonePageEpic,p.removePageEpic,u.changePageMetadataEpic,c.changePageOrderEpic,o.externalPageRemoveEpic,s.changePageMetadataPropEpic)},6621:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.fetchPagesEpic=void 0;var n=r(494),a=r(399),o=r(1688),i=r(418);t.fetchPagesEpic=function(t,r){return t.ofType(n.FETCH_PAGES).mergeMap((c=regeneratorRuntime.mark(function e(t){var i,c,u,s=t.payload.websiteId;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,a.getWebsitePages)(s);case 2:return i=e.sent,c=r.getState(),u=c.router.location,e.abrupt("return",[(0,n.fetchPagesFulfilledAction)({pages:i}),(0,o.checkPageAndRedirectHome)({websiteId:s,pages:i,location:u},r)].filter(Boolean));case 5:case"end":return e.stop()}},e,void 0)}),u=function(){var e=c.apply(this,arguments);return new Promise(function(t,r){return function n(a,o){try{var i=e[a](o),c=i.value}catch(e){return void r(e)}if(!i.done)return Promise.resolve(c).then(function(e){n("next",e)},function(e){n("throw",e)});t(c)}("next")})},function(e){return u.apply(this,arguments)})).mergeMap(e.spread(i.Observable.of));var c,u}}).call(this,r(380))},6622:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.externalPageRemoveEpic=void 0;var n=r(613),a=r(1688);t.externalPageRemoveEpic=function(t,r){return t.ofType(n.EXTERNAL_PAGE_REMOVE).map(function(t){var n=t.payload.id,o=r.getState(),i=o.router.location,c=o.pages,u=o.website._id;return(0,a.checkPageAndRedirectHome)({websiteId:u,pages:e.omit(n)(c),location:i},r)}).filter(Boolean)}}).call(this,r(380))},6623:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createPageEpic=void 0;var n=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,a=!1,o=void 0;try{for(var i,c=e[Symbol.iterator]();!(n=(i=c.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{!n&&c.return&&c.return()}finally{if(a)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=r(494),i=r(570),c=r(502),u=r(418),s=r(399),p=r(446),l=r(698),d=r(6624),f=r(1021);t.createPageEpic=function(e,t){return e.ofType(o.CREATE_PAGE).mergeMap(function(e){var r=e.payload,n=r.sortOrder,p=r.metadata,l=t.getState(),d=(0,i.selectWebsiteId)(l),v=(0,c.pagesSelector)(l),g={metadata:a({},p,{slug:(0,f.generateUniqSlug)({metadata:p,pages:v}),homepage:!1}),sortOrder:n};return u.Observable.fromPromise((0,s.addWebsitePage)({id:d,data:g})).map(function(e){var t=e.pageId,r=e.slug;return(0,o.createPageFulfilledAction)({pageId:t,data:a({},g,{slug:r})})}).catch(function(){return[]})}).ofType((0,p.withFulfilledType)(o.CREATE_PAGE)).do((r=regeneratorRuntime.mark(function e(r){var a,o,c,u,p,f,v,g=r.payload.pageId;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=(0,i.selectWebsiteId)(t.getState()),o=(0,l.genLocation)(g),e.prev=2,e.next=5,(0,d.getCustomBlock)();case 5:(c=e.sent)&&(u=c._id,p=c.roles,f=n(c.categories,1),v=f[0],(0,s.createBlockOnLocation)({websiteId:a,location:o,source:u,anchorName:v,roles:p,sortOrder:1})),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),console.error(e.t0);case 12:case"end":return e.stop()}},e,void 0,[[2,9]])}),v=function(){var e=r.apply(this,arguments);return new Promise(function(t,r){return function n(a,o){try{var i=e[a](o),c=i.value}catch(e){return void r(e)}if(!i.done)return Promise.resolve(c).then(function(e){n("next",e)},function(e){n("throw",e)});t(c)}("next")})},function(e){return v.apply(this,arguments)}));var r,v}},6624:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(6625);Object.defineProperty(t,"getCustomBlock",{enumerable:!0,get:function(){return(e=n,e&&e.__esModule?e:{default:e}).default;var e}})},6625:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(435);t.default=function(){return n.api.block.getCustom().data()}},6626:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.changePageOrderEpic=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=r(494),o=r(399),i=r(1021);t.changePageOrderEpic=function(e,t){return e.ofType(a.CHANGE_PAGE_ORDER).concatMap((r=regeneratorRuntime.mark(function e(r){var c,u,s,p,l,d=r.payload,f=d.pages,v=d.changedPage;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return c=t.getState(),u=c.website._id,s=c.pages,e.prev=1,p=s[v.id],l={metadata:n({},v.metadata,{slug:v.metadata.parentId!==p.metadata.parentId?(0,i.generateUniqSlug)({metadata:v.metadata,pages:f,slugId:v.slug}):v.metadata.slug}),sortOrder:v.sortOrder},e.next=6,(0,o.updateWebsitePage)({websiteId:u,pageId:v.id,data:l});case 6:return e.abrupt("return",(0,a.changePageOrderFulfilledAction)({changedPage:n({},v,l)}));case 9:return e.prev=9,e.t0=e.catch(1),e.abrupt("return",{type:""});case 12:case"end":return e.stop()}},e,void 0,[[1,9]])}),c=function(){var e=r.apply(this,arguments);return new Promise(function(t,r){return function n(a,o){try{var i=e[a](o),c=i.value}catch(e){return void r(e)}if(!i.done)return Promise.resolve(c).then(function(e){n("next",e)},function(e){n("throw",e)});t(c)}("next")})},function(e){return c.apply(this,arguments)})).filter(Boolean);var r,c}},6627:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.changePageMetadataEpic=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=r(494),o=r(446),i=r(399),c=r(1021);t.changePageMetadataEpic=function(e,t){return e.ofType(a.CHANGE_PAGE_METADATA,(0,o.withUndoType)(a.CHANGE_PAGE_METADATA),(0,o.withRedoType)(a.CHANGE_PAGE_METADATA)).mergeMap((r=regeneratorRuntime.mark(function e(r){var u,s,p,l,d,f,v,g,h,m=r.payload;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(u=m.pageId,s=t.getState(),p=s.pages,l=s.website._id,!p[u]){e.next=17;break}return e.prev=3,d=p[u],f=d.metadata,v=d.slug,(g=n({},f,m.metadata)).parentId!==f.parentId&&(g.slug=(0,c.generateUniqSlug)({metadata:g,pages:p,slugId:v})),e.next=9,(0,i.updateWebsitePage)({websiteId:l,pageId:u,data:{metadata:g}});case 9:return h=e.sent,e.abrupt("return",(0,a.changePageMetadataFulfilledAction)(n({pageId:u,metadata:g},h)));case 13:return e.prev=13,e.t0=e.catch(3),console.log("error changing page metadata",e.t0),e.abrupt("return",{type:(0,o.withRejectType)(a.CHANGE_PAGE_METADATA)});case 17:case"end":return e.stop()}},e,void 0,[[3,13]])}),u=function(){var e=r.apply(this,arguments);return new Promise(function(t,r){return function n(a,o){try{var i=e[a](o),c=i.value}catch(e){return void r(e)}if(!i.done)return Promise.resolve(c).then(function(e){n("next",e)},function(e){n("throw",e)});t(c)}("next")})},function(e){return u.apply(this,arguments)})).filter(Boolean);var r,u}},6628:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.changePageMetadataPropEpic=void 0;var n=r(494),a=r(446),o=r(399),i=r(418);t.changePageMetadataPropEpic=function(e,t){return e.ofType(n.CHANGE_PAGES_METADATA_PROP,(0,a.withUndoType)(n.CHANGE_PAGES_METADATA_PROP),(0,a.withRedoType)(n.CHANGE_PAGES_METADATA_PROP)).mergeMap((r=regeneratorRuntime.mark(function e(r){var n,a,i,c,u=r.type,s=r.payload,p=s.key,l=s.value,d=s.pages;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.getState(),a=n.website._id,e.prev=1,e.next=4,(0,o.updatePagesMetadataProp)({websiteId:a,key:p,value:l,pages:d});case 4:return i=e.sent,c=i.ok,e.abrupt("return",c&&{type:u,key:p,value:l,pages:d});case 9:return e.prev=9,e.t0=e.catch(1),e.abrupt("return",{type:""});case 12:case"end":return e.stop()}},e,void 0,[[1,9]])}),c=function(){var e=r.apply(this,arguments);return new Promise(function(t,r){return function n(a,o){try{var i=e[a](o),c=i.value}catch(e){return void r(e)}if(!i.done)return Promise.resolve(c).then(function(e){n("next",e)},function(e){n("throw",e)});t(c)}("next")})},function(e){return c.apply(this,arguments)})).filter(Boolean).mergeMap(function(e){var t=e.key,r=e.value,a=e.pages;return i.Observable.of((0,n.changePagesMetadataPropFulfilledAction)({key:t,value:r,pages:a})).filter(Boolean)});var r,c}},6629:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.removePageEpic=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=r(418),o=r(494),i=r(399),c=r(446),u=r(6630),s=r(640),p=r(1688);function l(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function d(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(a,o){try{var i=t[a](o),c=i.value}catch(e){return void r(e)}if(!i.done)return Promise.resolve(c).then(function(e){n("next",e)},function(e){n("throw",e)});e(c)}("next")})}}var f,v,g=(f=d(regeneratorRuntime.mark(function t(r,a,o){var c,u,p,l,d,f,v,g,h,m,y,E,b,T,O,P,A;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:c=(0,s.getPagesBySortOrder)(a).filter(function(e){return e.id!==r}),u=e.filter(function(e){return e.metadata.parentId===a[r].slug},c),p=e.findIndex({metadata:{parentId:a[r].slug}},c),l=e.findLastIndex({metadata:{parentId:a[r].slug}},c),d=c[p-1],f=c[l+1],v=null,g=null,d&&f?(v=(0,s.getSortOrder)(d),g=(0,s.getSortOrder)(f)):!d&&f?(g=(0,s.getSortOrder)(f),v=g-u.length):d&&!f?(v=(0,s.getSortOrder)(d),g=v+u.length):d||f||(v=0,g=0),h=(g-v)/(u.length+1),m=u.map(function(e,t){return n({},e,{sortOrder:v+h*(t+1),metadata:n({},e.metadata,{parentId:null})})}),y=!0,E=!1,b=void 0,t.prev=14,T=m[Symbol.iterator]();case 16:if(y=(O=T.next()).done){t.next=24;break}return P=O.value,A=e.pick(["sortOrder","metadata"],P),t.next=21,(0,i.updateWebsitePage)({websiteId:o,pageId:P.id,data:A});case 21:y=!0,t.next=16;break;case 24:t.next=30;break;case 26:t.prev=26,t.t0=t.catch(14),E=!0,b=t.t0;case 30:t.prev=30,t.prev=31,!y&&T.return&&T.return();case 33:if(t.prev=33,!E){t.next=36;break}throw b;case 36:return t.finish(33);case 37:return t.finish(30);case 38:return t.abrupt("return",m);case 39:case"end":return t.stop()}},t,void 0,[[14,26,30,38],[31,,33,37]])})),function(e,t,r){return f.apply(this,arguments)}),h=(v=d(regeneratorRuntime.mark(function t(r,n,a){var o,c,u,s,p,l,d;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:o=e.pipe(e.pickBy(function(e){return e.metadata.parentId===n[r].slug}),e.keys)(n),c=!0,u=!1,s=void 0,t.prev=4,p=o[Symbol.iterator]();case 6:if(c=(l=p.next()).done){t.next=13;break}return d=l.value,t.next=10,(0,i.removeWebsitePage)({id:a,pageId:d});case 10:c=!0,t.next=6;break;case 13:t.next=19;break;case 15:t.prev=15,t.t0=t.catch(4),u=!0,s=t.t0;case 19:t.prev=19,t.prev=20,!c&&p.return&&p.return();case 22:if(t.prev=22,!u){t.next=25;break}throw s;case 25:return t.finish(22);case 26:return t.finish(19);case 27:return t.abrupt("return",o);case 28:case"end":return t.stop()}},t,void 0,[[4,15,19,27],[20,,22,26]])})),function(e,t,r){return v.apply(this,arguments)});t.removePageEpic=function(t,r){return t.ofType(o.REMOVE_PAGE).concatMap((s=d(regeneratorRuntime.mark(function s(d){var f,v,m,y,E,b,T,O,P,A=d.payload,_=A.pageId,w=A.removeSubpages;return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(f=r.getState(),v=f.router.location,m=f.website._id,y=f.pages,y[_]){s.next=4;break}return s.abrupt("return",[]);case 4:return E=[],b=[],s.prev=6,s.next=9,(0,i.removeWebsitePage)({id:m,pageId:_});case 9:if(!w){s.next=15;break}return s.next=12,h(_,y,m);case 12:E=s.sent,s.next=18;break;case 15:return s.next=17,g(_,y,m);case 17:b=s.sent;case 18:s.next=23;break;case 20:return s.prev=20,s.t0=s.catch(6),s.abrupt("return",a.Observable.of({type:""}));case 23:return T=y[_].metadata.homepage,O=(0,u.dispatchWaitMergeCreator)(t),P=function(){return a.Observable.of.apply(a.Observable,l(e.compact([(0,p.checkPageAndRedirectHome)({websiteId:m,pages:r.getState().pages,location:v},r)])))},s.abrupt("return",O((0,o.removePageFulfilledAction)({pageIds:[_].concat(l(E)),removeSubpages:w,pagesWithRemovedParent:b}),(0,c.withPermissionType)((0,c.withFulfilledType)(o.REMOVE_PAGE)),function(){var e=(0,p.getNewHomepage)(r.getState().pages);return T?O((0,o.changePageMetadataAction)({pageId:e[0],metadata:n({},e[1].metadata,{homepage:!0})}),(0,c.withPermissionType)((0,c.withFulfilledType)(o.CHANGE_PAGE_METADATA)),P):P()}));case 27:case"end":return s.stop()}},s,void 0,[[6,20]])})),function(e){return s.apply(this,arguments)})).mergeMap(e.identity);var s}}).call(this,r(380))},6630:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.dispatchWaitMergeCreator=void 0;var n=r(418);t.dispatchWaitMergeCreator=function(e){return function(t,r,a){return n.Observable.merge(e.ofType(r).first().mergeMap(a),n.Observable.of(t))}}},6631:function(e,t,r){"use strict";(function(e,n){Object.defineProperty(t,"__esModule",{value:!0}),t.clonePageEpic=void 0;var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=r(494),i=r(399),c=r(6632),u=r(1021);t.clonePageEpic=function(t,r){return t.ofType(o.CLONE_PAGE).exhaustMap((s=regeneratorRuntime.mark(function t(s){var p,l,d,f,v,g,h,m,y,E,b,T,O,P,A,_,w=s.payload.pageId;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return p=r.getState(),l=p.website._id,d=p.pages,f=d[w],v=f.metadata,g=f.metadata.displayName,h=e.pipe(n.keyToProp("id"),e.sortBy(e.getOr(0,"sortOrder")))(d),m=e.findIndex({id:w},h),y=h[m],E=h[m+1],b=E?(e.getOr(0,"sortOrder",y)+e.getOr(0,"sortOrder",E))/2:e.getOr(0,"sortOrder",y)+1,T=e.pipe(e.pick(["seoTitle","seoDescription","snTitle","snDescription","snImage","snImageComputed","modifier","parentId","slug","displayName"]),e.omitBy(e.isUndefined))(v),O={metadata:a({},T,{slug:(0,u.generateUniqSlug)({metadata:T,pages:d}),displayName:(0,c.generateDuplicateName)(d,g,"metadata.displayName")}),content:{},sortOrder:b},t.prev=9,t.next=12,(0,i.cloneWebsitePage)({id:l,data:O,pageId:w});case 12:return P=t.sent,A=P.pageId,_=P.slug,t.abrupt("return",(0,o.createPageFulfilledAction)({pageId:A,data:a({},O,{slug:_})}));case 18:return t.prev=18,t.t0=t.catch(9),t.abrupt("return",{type:""});case 21:case"end":return t.stop()}},t,void 0,[[9,18]])}),p=function(){var e=s.apply(this,arguments);return new Promise(function(t,r){return function n(a,o){try{var i=e[a](o),c=i.value}catch(e){return void r(e)}if(!i.done)return Promise.resolve(c).then(function(e){n("next",e)},function(e){n("throw",e)});t(c)}("next")})},function(e){return p.apply(this,arguments)}));var s,p}}).call(this,r(380),r(391))},6632:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,a=!1,o=void 0;try{for(var i,c=e[Symbol.iterator]();!(n=(i=c.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{!n&&c.return&&c.return()}finally{if(a)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();t.generateDuplicateName=function(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"name",o=-1,i=new RegExp("^"+n+"(\\scopy(\\s\\d+)?)?$");return e.forEach(function(t){var n=e.get(a,t).match(i)||[],c=r(n,3),u=c[0],s=c[1],p=c[2];p?o=Math.max(o,p):o<1&&s?o=1:o<0&&u&&(o=0)})(t),o<0?n:n+" copy"+(o?" "+(o+1):"")}}).call(this,r(380))},6633:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.blocksEpic=void 0;var n=r(921),a=r(6634),o=r(6635),i=r(1625),c=r(6638),u=r(6639),s=r(6641),p=r(6642),l=r(6643),d=r(6644),f=r(6645);t.blocksEpic=(0,n.combineEpics)(a.changeSortOrderEpic,o.createBlockEpic,i.fetchBlocksEpic,c.cloneBlockEpic,u.cloneBlockToPagesEpic,s.toggleHiddenStatusEpic,p.removeBlockEpic,l.serverUpdateBlockEpic,d.updateBlockEpic,f.updateToSourceEpic)},6634:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.changeSortOrderEpic=void 0;var n=r(446),a=r(459),o=r(1238);t.changeSortOrderEpic=function(t,r){return t.ofType(a.CHANGE_SORT_ORDER,(0,n.withRedoType)(a.CHANGE_SORT_ORDER),(0,n.withUndoType)(a.CHANGE_SORT_ORDER)).switchMap(function(t){var n=t.payload,i=n.id,c=n.targetId,u=n.position,s=r.getState().blocks,p=s[c].sortOrder,l=void 0;return l="before"===u?(0,o.calcNewOrders)(i,"decrease",e.set(i+".sortOrder",p+1e-4,s)):(0,o.calcNewOrders)(i,"increase",e.set(i+".sortOrder",p-1e-4,s)),Object.keys(l).map(function(e){var t=l[e];return(0,a.updateBlockFulfilledAction)(e,{sortOrder:t})})})}}).call(this,r(380))},6635:function(e,t,r){"use strict";(function(e,n){Object.defineProperty(t,"__esModule",{value:!0}),t.createBlockEpic=void 0;var a=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,a=!1,o=void 0;try{for(var i,c=e[Symbol.iterator]();!(n=(i=c.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{!n&&c.return&&c.return()}finally{if(a)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=r(418),c=r(459),u=r(555),s=r(611),p=r(6636),l=r(710),d=r(583),f=r(627),v=r(399),g=r(745),h=r(2265),m=r(436),y=r(1507),E=r(2781);function b(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(a,o){try{var i=t[a](o),c=i.value}catch(e){return void r(e)}if(!i.done)return Promise.resolve(c).then(function(e){n("next",e)},function(e){n("throw",e)});e(c)}("next")})}}var T=e.propSatisfies("roles",n.includes("removed")),O=function(e){var t=e.location,r=e.pageBlocks,a=e.position;return n.startsWith("WebsitePage:",t)?(0,E.getAverageSortOrder)({blocks:r,position:a}):0};t.createBlockEpic=function(t,r){return t.ofType(c.CREATE_BLOCK).mergeMap((E=b(regeneratorRuntime.mark(function t(E){var P,A,_,w,R,k,S,C,M,x,I,N,B,U,G,H,j,D,L,F,W,K,V,q,Y,z=E.payload,Z=z.source,X=z.createBlockProps,J=X.location,$=X.categories,Q=X.position,ee=X.sortOrder,te=X.anchorName,re=X.askLocation,ne=X.noScroll,ae=function(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}(X,["location","categories","position","sortOrder","anchorName","askLocation","noScroll"]);return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,P=r.getState(),A=(0,g.incrementAnchor)({anchorName:te,blocks:P.blocks,categories:$}),_=P.blocks,w=n.pickBy(n.propEq("location",J),_),R=void 0,ne||("header"===J?R=0:"footer"===J?R=document.body.getBoundingClientRect().height:(k=n.size(w),S=Q===n.size(w)||Q===Number.POSITIVE_INFINITY,(C=k?n.pipe(e.keyToProp("id"),n.sortBy("sortOrder"),n.nth(Math.min(k-1,S?Q-1:Q)))(w):n.find(n.propEq("location","header"),_))&&(M=document.getElementById(T(C)?"block-removed-"+C.id:"blockId-"+C.id),x=M?M.getBoundingClientRect():0,I=x.top,N=x.bottom,B="header"===C.location||S?N:I,R=B+window.scrollY-100))),U=n.path(["website","_id"])(P),t.next=10,(0,v.createBlockOnLocation)(o({},ae,{anchorName:A,source:Z,websiteId:U,location:J,sortOrder:ee||O({location:J,pageBlocks:w,position:Q})}));case 10:return G=t.sent,H=G.block,j=G.block.id,D=(0,h.getAppsByRoles)(H.roles),L=[],D.forEach(function(e){var t=e.application;L.push(b(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.installAndSetApp)({websiteId:U,application:t,type:"editor"});case 2:"blog"===t&&((0,d.trigger)("blog_installed_feed"),(0,f.pushEvent)({event:"Blog Connected",eventCategory:"Apps",eventAction:"Blog",eventLabel:"Connected"}));case 3:case"end":return e.stop()}},e,void 0)}))())}),t.prev=16,t.next=19,Promise.all(L);case 19:t.next=24;break;case 21:t.prev=21,t.t0=t.catch(16),console.error(t.t0);case 24:return t.next=26,(0,y.getBlockContent)(H);case 26:if(F=t.sent,W=r.getState(),K=W.router.location.pathname,V=J.split(":"),q=a(V,2),!(Y=q[1])||K.match(Y)){t.next=31;break}return t.abrupt("return",[]);case 31:return null!=R&&setTimeout(function(){return(0,m.smoothyScrollTo)(R,400,"easeInOutCirc")},0),t.abrupt("return",i.Observable.of((0,s.closeAllModalsAction)(),(0,c.createBlockFulfilledAction)(j,o({},ae,H,{content:F,anchorName:A})),re&&(0,s.openModalAction)({id:p.BindedBlockModal.id,props:{location:re,blockId:j,dispatch:r.dispatch}}),(0,u.getWebsiteAppsAction)()).filter(Boolean));case 35:return t.prev=35,t.t1=t.catch(0),t.abrupt("return",[]);case 38:case"end":return t.stop()}},t,void 0,[[0,35],[16,21]])})),function(e){return E.apply(this,arguments)})).switchMap(n.identity);var E}}).call(this,r(391),r(380))},6636:function(e,t,r){"use strict";(function(e,n,a){Object.defineProperty(t,"__esModule",{value:!0}),t.BindedBlockModal=void 0;var o=g(r(390)),i=g(r(384)),c=g(r(385)),u=g(r(383)),s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),p=r(398),l=r(459),d=r(381),f=r(436),v=g(r(6637));function g(e){return e&&e.__esModule?e:{default:e}}function h(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var m={header:(0,d.getStringByKey)("add-header-block"),footer:(0,d.getStringByKey)("add-footer-block")},y=function(t){function r(){var e,t,n,a,o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);for(var i=arguments.length,c=Array(i),u=0;u<i;u++)c[u]=arguments[u];return t=n=h(this,(e=r.__proto__||Object.getPrototypeOf(r)).call.apply(e,[this].concat(c))),n.addToAllPages=(a=regeneratorRuntime.mark(function e(){var t,r,a,i,c,u,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=n.props,r=t.blockId,a=t.location,i=t.closeModal,c=t.dispatch,u=void 0,s={},"header"===a?(u=0,s.changeMetadata={key:"hideHeader",value:!1,ignoreHistory:!0}):"footer"===a&&(u=document.body.getBoundingClientRect().height,s.changeMetadata={key:"hideFooter",value:!1,ignoreHistory:!0}),c((0,l.updateBlockAction)(r,{location:a},s)),i(),setTimeout(function(){return(0,f.smoothyScrollTo)(u,300)},0);case 7:case"end":return e.stop()}},e,o)}),function(){var e=a.apply(this,arguments);return new Promise(function(t,r){return function n(a,o){try{var i=e[a](o),c=i.value}catch(e){return void r(e)}if(!i.done)return Promise.resolve(c).then(function(e){n("next",e)},function(e){n("throw",e)});t(c)}("next")})}),h(n,t)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(r,e.Component),s(r,[{key:"render",value:function(){var t=this.props,r=t.closeModal,a=t.location;return e.createElement(o.default,{onClose:r,title:(0,d.getStringByKey)("title-add-to-all-pages")+"?",notDraggable:!0,withOverlay:!0},e.createElement("div",{className:n(v.default.container,"px-16 pb-24 pt-16")},e.createElement(u.default,null,m[a]),e.createElement(i.default,{mixClassName:"mt-16"},e.createElement(c.default,{className:"primary size-small",mixClassName:"mr-8",onClick:this.addToAllPages},(0,d.getStringByKey)("add-to-all-pages")),e.createElement(c.default,{className:"size-small",onClick:r},(0,d.getStringByKey)("only-to-this-page")))))}}]),r}();y.propTypes={blockId:a.string.isRequired,location:a.string.isRequired,closeModal:a.func.isRequired,dispatch:a.func.isRequired};t.BindedBlockModal=p.registerModal?(0,p.registerModal)(y):{}}).call(this,r(1),r(379),r(49))},6637:function(e,t,r){e.exports={container:"container_O4O"}},6638:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.cloneBlockEpic=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=r(459),o=r(698),i=r(412);t.cloneBlockEpic=function(t,r){return t.ofType(a.CLONE_BLOCK).filter(function(t){var n=t.payload.id;return e.pipe(function(e){return(0,a.makeBlockSelector)()(e,n)},e.overEvery(o.isPageBlock,e.negate(o.isRemoved)))(r.getState())}).map(function(t){var c=t.payload.id,u=r.getState(),s=(0,i.getCurrentPage)(r.getState()),p=(0,a.pageBlocksSelector)(u),l=e.findIndex(e.propEq("id",c))(p)+1,d=(0,o.genLocation)(s),f=e.pipe(e.find(e.propEq("id",c)),e.pick(["content","modifier","name","roles","categories","anchorName"]))(p);return(0,a.createBlockAction)(c,n({location:d,position:l},f))})}}).call(this,r(380))},6639:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.cloneBlockToPagesEpic=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=r(418),o=r(585),i=r(381),c=r(459),u=r(745),s=r(2781),p=r(412),l=r(698),d=r(2780),f=r(6640),v=r(570),g=r(442);t.cloneBlockToPagesEpic=function(t,r){return t.ofType(c.CLONE_BLOCK_TO_PAGES).mergeMap(function(t){var h=t.payload,m=h.source,y=h.targetPageIds,E=h.createBlockProps,b=E.categories,T=E.anchorName,O=(E.askLocation,function(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}(E,["categories","anchorName","askLocation"])),P=r.getState(),A=(0,v.selectWebsiteId)(P);if(function(t,r){return e.allPass([e.pipe(e.size,e.isEqual(1)),e.negate(e.includes(t))])(r)}((0,p.getCurrentPage)(P),y)){var _=e.first(y),w=(0,i.getStringByKey)("language-route-prefix"),R=(0,f.selectIsDraftium)(P),k=""+("en"===w?"":w)+(0,o.getEditorInnerLink)((R?"structure":"website")+"/"+A+"/"+_);return a.Observable.of((0,d.preChangeLocationAction)({path:k,onPageReadyAction:(0,c.createBlockAction)(m,n({},O,{location:(0,l.genLocation)(_),anchorName:T,categories:b,sortOrder:s.SORT_POSITION_BOTTOM}))}))}var S=(0,u.incrementAnchor)({anchorName:T,blocks:P.blocks,categories:b}),C=n({},O,{anchorName:S,categories:b}),M=e.pipe(e.size,e.isEqual(1))(y),x=y.map(function(e){var t=(0,l.genLocation)(e);return(0,c.createBlockAction)(m,n({location:t,sortOrder:s.SORT_POSITION_BOTTOM,noScroll:!M},C))});return!M&&(0,g.addToaster)({type:"success",timer:3e3,message:(0,i.getStringByKey)("copy-block-to-pages-success")}),a.Observable.from(x)})}}).call(this,r(380))},6640:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.selectIsDraftium=t.selectAuth=void 0;var n=r(664),a=t.selectAuth=e.get("auth");t.selectIsDraftium=(0,n.createSelector)(a,e.get("draftium"))}).call(this,r(380))},6641:function(e,t,r){"use strict";(function(e,n){Object.defineProperty(t,"__esModule",{value:!0}),t.toggleHiddenStatusEpic=void 0;var a=r(412),o=r(459),i=r(494),c=r(502),u=r(698);t.toggleHiddenStatusEpic=function(t,r){return t.ofType(o.TOGGLE_HIDDEN_STATUS).map(function(t){var s,p,l,d=t.payload.id,f=r.getState(),v=(0,a.getCurrentPage)(f),g=(0,c.getCurrentPage)(f),h=(0,o.makeBlockSelector)()(f,d),m=(0,u.isSpawning)(h),y=!(0,u.isHiddenSpawningOrBlock)(g,h);if(m){var E=(0,u.isGlobalHeader)(h)?"hideHeader":"hideFooter";return(0,i.changePageMetadataAction)({pageId:v,metadata:(s={},p=E,l=y,p in s?Object.defineProperty(s,p,{value:l,enumerable:!0,configurable:!0,writable:!0}):s[p]=l,s)})}var b=e.pipe(e.get("roles"),n.ifElse(function(){return y},e.pipe(e.uniq,n.push("hidden")),e.without(["hidden"])))(h);return(0,o.updateBlockAction)(d,{roles:b})})}}).call(this,r(380),r(391))},6642:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.removeBlockEpic=void 0;var n=r(459),a=r(446);function o(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}t.removeBlockEpic=function(t,r){return t.ofType(n.REMOVE_BLOCK,(0,a.withUndoType)(n.REMOVE_BLOCK)).mergeMap((i=regeneratorRuntime.mark(function t(a){var i,c=a.payload.id;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=e.get(["blocks",c,"roles"])(r.getState())||[],t.abrupt("return",(0,n.removeBlockFulfilledAction)(c,{roles:[].concat(o(i),["removed"])}));case 2:case"end":return t.stop()}},t,void 0)}),c=function(){var e=i.apply(this,arguments);return new Promise(function(t,r){return function n(a,o){try{var i=e[a](o),c=i.value}catch(e){return void r(e)}if(!i.done)return Promise.resolve(c).then(function(e){n("next",e)},function(e){n("throw",e)});t(c)}("next")})},function(e){return c.apply(this,arguments)}));var i,c}}).call(this,r(380))},6643:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.serverUpdateBlockEpic=void 0;var n,a=r(418),o=r(1027),i=r(1234),c=r(446),u=r(459),s=r(399),p=r(2592),l=(n=p)&&n.__esModule?n:{default:n};function d(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(a,o){try{var i=t[a](o),c=i.value}catch(e){return void r(e)}if(!i.done)return Promise.resolve(c).then(function(e){n("next",e)},function(e){n("throw",e)});e(c)}("next")})}}var f=e,v=f.isEqual,g=f.spread;t.serverUpdateBlockEpic=function(t,r){var n,p=function(e){return r.getState().blocks[e]},f=function(t){return e.get(["blocks",t])(r.getState())},h=(0,c.withPermissionType)((0,c.withFulfilledType)(u.UPDATE_BLOCK)),m=(0,c.withPermissionType)((0,c.withFulfilledType)(u.REMOVE_BLOCK)),y={};return t.ofType(h,m).filter(function(e){return!e.payload.block.__TESTUPDATE__}).mergeMap((n=d(regeneratorRuntime.mark(function t(n){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",l.default.lock(d(regeneratorRuntime.mark(function t(){var a,c,u,l;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=n.payload,c=a.block,u=a.id,(l=y[u]=y[u]||{last:Promise.resolve(),nextArgs:n}).nextArgs=n,t.next=5,l.last.catch(function(){});case 5:return l.nextArgs===n&&(l.last=d(regeneratorRuntime.mark(function t(){var a,d,g,h;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0,a=e.pick(e.keys(c)),d=void 0,g=a(p(u));case 4:return d=g,t.next=7,(0,s.updateBlock)({id:u,data:d,websiteId:e.get("website._id")(r.getState())});case 7:g=a(p(u));case 8:if(!v(d)(g)){t.next=4;break}case 9:t.next=23;break;case 11:return t.prev=11,t.t0=t.catch(0),t.prev=13,t.next=16,f(u);case 16:return h=t.sent,t.abrupt("return",[h]);case 20:return t.prev=20,t.t1=t.catch(13),t.abrupt("return",[]);case 23:return t.prev=23,l.nextArgs===n&&([i.READY,i.LOADING].includes((0,o.getEditorStatus)())||(0,o.changeEditorStatus)(i.SAVED),delete y[u]),t.finish(23);case 26:case"end":return t.stop()}},t,void 0,[[0,11,23,26],[13,20]])}))()),t.abrupt("return",l.last);case 7:case"end":return t.stop()}},t,void 0)}))));case 1:case"end":return t.stop()}},t,void 0)})),function(e){return n.apply(this,arguments)})).mergeMap(g(a.Observable.of))}}).call(this,r(380))},6644:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateBlockEpic=void 0;var n=r(418),a=r(446),o=r(494),i=r(459);t.updateBlockEpic=function(e){return e.ofType(i.UPDATE_BLOCK,(0,a.withRedoType)(i.UPDATE_BLOCK),(0,a.withUndoType)(i.UPDATE_BLOCK)).mergeMap(function(e){var t=e.payload,r=t.id,c=t.block,u=t.changeMetadata,s=e.type;return n.Observable.of((0,a.withPermission)((0,i.updateBlockFulfilledAction)(r,c,s)),u&&(0,o.changePagesMetadataPropAction)(u)).filter(Boolean)})}},6645:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateToSourceEpic=void 0;var n=r(459),a=r(399),o=r(446);t.updateToSourceEpic=function(e){return e.ofType(n.UPDATE_TO_SOURCE,(0,o.withUndoType)(n.UPDATE_TO_SOURCE),(0,o.withRedoType)(n.UPDATE_TO_SOURCE)).switchMap((t=regeneratorRuntime.mark(function e(t){var r,o,i,c,u,s=t.payload,p=s.id,l=s.sourceVersion,d=s.sourceId;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,a.updateBlockToSource)({id:p,sourceId:d,sourceVersion:l});case 2:return r=e.sent,o=r.viewRef,i=r.version,c=r.name,u=r.source,e.abrupt("return",(0,n.updateToSourceFulfilledAction)({id:p,viewRef:o,version:i,name:c,source:u}));case 8:case"end":return e.stop()}},e,void 0)}),r=function(){var e=t.apply(this,arguments);return new Promise(function(t,r){return function n(a,o){try{var i=e[a](o),c=i.value}catch(e){return void r(e)}if(!i.done)return Promise.resolve(c).then(function(e){n("next",e)},function(e){n("throw",e)});t(c)}("next")})},function(e){return r.apply(this,arguments)}));var t,r}},6646:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uiKitEpic=void 0;var n=r(921),a=r(6647),o=r(2269),i=r(2267);t.uiKitEpic=(0,n.combineEpics)(a.changeCurrentUiKitPreset,o.changePaletteColorsEpic,o.updateWebsiteColorsEpic,i.fetchUIKitEpic,a.changeCurrentUikitTypography,o.changeTypographySettingsEpic,o.updateWebsiteTypographyEpic,a.changeCurrentUikitButtonPreset,o.changeButtonSettingsEpic,o.externalChangeButton,o.externalChangePalette,o.externalChangeTypography)},6647:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.changeCurrentUikitButtonPreset=t.changeCurrentUikitTypography=t.changeCurrentUiKitPreset=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=r(418),o=r(996),i=r(555),c=r(399),u=r(468),s=r(1129),p=r(945),l=r(1130),d=r(446);function f(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(a,o){try{var i=t[a](o),c=i.value}catch(e){return void r(e)}if(!i.done)return Promise.resolve(c).then(function(e){n("next",e)},function(e){n("throw",e)});e(c)}("next")})}}t.changeCurrentUiKitPreset=function(t,r){return t.ofType(i.CHANGE_CURRENT_PRESET,(0,d.withRedoType)(i.CHANGE_CURRENT_PRESET),(0,d.withUndoType)(i.CHANGE_CURRENT_PRESET)).mergeMap((p=f(regeneratorRuntime.mark(function e(t){var p,l,d,f,v,g,h,m,y=t.payload,E=y.id,b=y.previousSelection;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,p=r.getState().website,l=p.uikitTypography,d=p.uikitButton,f=p._id,e.next=4,(0,c.updateWebsite)({id:f,data:{uikitPalette:E},payload:{type:"uikit"}});case 4:return v=e.sent,g=v.uikitPalette,e.next=8,(0,s.getColorPalette)({id:g});case 8:return h=e.sent,m=(0,u.generateUIKit)({uikitTypography:l,uikitButton:d,uikitPalette:h}),e.abrupt("return",a.Observable.of((0,i.changeCurrentPresetFulfilledAction)(n({},h,{previousSelection:b})),(0,o.fetchUIKitFulfilledAction)(m)));case 13:return e.prev=13,e.t0=e.catch(0),e.abrupt("return",[]);case 16:case"end":return e.stop()}},e,void 0,[[0,13]])})),function(e){return p.apply(this,arguments)})).switchMap(e.identity);var p},t.changeCurrentUikitTypography=function(t,r){return t.ofType(i.CHANGE_CURRENT_TYPOGRAPHY,(0,d.withRedoType)(i.CHANGE_CURRENT_TYPOGRAPHY),(0,d.withUndoType)(i.CHANGE_CURRENT_TYPOGRAPHY)).mergeMap((n=f(regeneratorRuntime.mark(function e(t){var n,s,l,d,f,v,g,h,m=t.payload.id;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=r.getState().website,s=n.uikitButton,l=n.uikitPalette,d=n._id,e.next=4,(0,c.updateWebsite)({id:d,data:{uikitTypography:m},payload:{type:"uikit"}});case 4:return f=e.sent,v=f.uikitTypography,e.next=8,(0,p.getTypographyPreset)({id:v});case 8:return g=e.sent,h=(0,u.generateUIKit)({uikitTypography:g,uikitButton:s,uikitPalette:l}),(0,u.loadGoogleFontsFromUiKit)(h),e.abrupt("return",a.Observable.of((0,i.changeCurrentTypographyFulfilledAction)(g),(0,o.fetchUIKitFulfilledAction)(h)));case 14:return e.prev=14,e.t0=e.catch(0),e.abrupt("return",[]);case 17:case"end":return e.stop()}},e,void 0,[[0,14]])})),function(e){return n.apply(this,arguments)})).switchMap(e.identity);var n},t.changeCurrentUikitButtonPreset=function(t,r){return t.ofType(i.CHANGE_CURRENT_BUTTON_PRESET).mergeMap((n=f(regeneratorRuntime.mark(function e(t){var n,s,p,d,f,v,g,h,m=t.payload.id;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=r.getState().website,s=n.uikitTypography,p=n.uikitPalette,d=n._id,e.next=4,(0,c.updateWebsite)({id:d,data:{uikitButton:m},payload:{type:"uikit"}});case 4:return f=e.sent,v=f.uikitButton,e.next=8,(0,l.getButtonPreset)({id:v});case 8:return g=e.sent,h=(0,u.generateUIKit)({uikitTypography:s,uikitButton:g,uikitPalette:p}),(0,u.loadGoogleFontsFromUiKit)(h),e.abrupt("return",a.Observable.of((0,i.changeCurrentButtonPresetFulfilledAction)(g),(0,o.fetchUIKitFulfilledAction)(h)));case 14:return e.prev=14,e.t0=e.catch(0),e.abrupt("return",[]);case 17:case"end":return e.stop()}},e,void 0,[[0,14]])})),function(e){return n.apply(this,arguments)})).switchMap(e.identity);var n}}).call(this,r(380))},6648:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchBlockTemplatesEpic=void 0;var n=r(418),a=r(1624),o=r(399);t.fetchBlockTemplatesEpic=function(e){return e.ofType(a.FETCH_BLOCK_TEMPLATES).mergeMap(function(e){var t=e.payload.filter;return n.Observable.fromPromise((0,o.getBlockTemplates)(t)).map(function(e){return(0,a.fetchBlockTemplatesFulfilledAction)({blockTemplates:e})})})}},6649:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.fetchViewsEpic=void 0;var n=r(418),a=r(853),o=r(2620),i=r(1239),c=r(494),u=p(r(1510)),s=p(r(2616));function p(e){return e&&e.__esModule?e:{default:e}}t.fetchViewsEpic=function(t){return t.ofType(i.FETCH_VIEW).distinct(e.path(["payload","viewRef"])).mergeMap((r=regeneratorRuntime.mark(function e(t){var r,n,p=t.payload,l=p.viewRef,d=p.pageId,f=p.view;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,o.getView)(l,f);case 2:return r=e.sent,n=r.styles,(0,a.setView)(l,(0,u.default)(n)((0,s.default)(r))),e.abrupt("return",[(0,i.fetchViewFulfilledAction)(l),(0,c.readyPageAction)(d)]);case 6:case"end":return e.stop()}},e,void 0)}),p=function(){var e=r.apply(this,arguments);return new Promise(function(t,r){return function n(a,o){try{var i=e[a](o),c=i.value}catch(e){return void r(e)}if(!i.done)return Promise.resolve(c).then(function(e){n("next",e)},function(e){n("throw",e)});t(c)}("next")})},function(e){return p.apply(this,arguments)})).switchMap(e.apply(n.Observable.of));var r,p}}).call(this,r(380))},6650:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.updateWebsiteEpic=t.getWebsiteAppsEpic=t.fetchWebsiteEpic=void 0;var n=r(585),a=r(617),o=r(555),i=r(494),c=r(1029),u=r(1270),s=r(1030),p=r(710),l=r(399);function d(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(a,o){try{var i=t[a](o),c=i.value}catch(e){return void r(e)}if(!i.done)return Promise.resolve(c).then(function(e){n("next",e)},function(e){n("throw",e)});e(c)}("next")})}}t.fetchWebsiteEpic=function(t,r){return t.ofType(o.FETCH_WEBSITE).filter(function(e){return e.payload.websiteId}).switchMap((a=d(regeneratorRuntime.mark(function t(a){var d,f,v,g,h,m,y=a.payload,E=a.payload.websiteId;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return window.websiteId=E,d={},f=void 0,t.prev=3,t.next=6,(0,l.getWebsiteById)(E);case 6:return d=t.sent,t.next=9,(0,l.getWebsitePublishedDomains)(E);case 9:d.publishedDomains=t.sent,f=(d.roles||[]).includes("structure"),t.next=17;break;case 13:return t.prev=13,t.t0=t.catch(3),console.error(t.t0),t.abrupt("return",[]);case 17:if(v=r.getState(),g=v.builderType,!(d.roles||[]).includes("future")){t.next=21;break}return(0,n.redirectTo)(f?"prototype":"website"),t.abrupt("return",[]);case 21:if((h=[(0,o.fetchWebsiteFulfilledAction)(d),(0,s.fetchCoreThemeAction)(),(0,s.fetchPublicThemesAction)(),(0,s.fetchWebsiteThemeAction)(),(0,i.fetchPagesAction)(y),(0,c.fetchCommentsAction)(E)]).push((0,u.fetchOrgAction)()),m="comment"===g,d.history||m){t.next=27;break}return t.next=27,(0,l.removeBlocks)(d._id).catch(e.noop);case 27:if(t.t1=!m,!t.t1){t.next=31;break}return t.next=31,(0,p.registerWebsiteApps)(d,"editor");case 31:return t.abrupt("return",h);case 32:case"end":return t.stop()}},t,void 0,[[3,13]])})),function(e){return a.apply(this,arguments)})).mergeMap(e.identity);var a},t.getWebsiteAppsEpic=function(e,t){return e.ofType(o.GET_WEBSITE_APPS).switchMap(d(regeneratorRuntime.mark(function e(){var r,n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.getState(),n=r.website._id,e.prev=1,e.next=4,(0,a.getWebsiteApps)({id:n});case 4:return i=e.sent,e.abrupt("return",(0,o.updateWebsiteFulfilled)({apps:i}));case 8:e.prev=8,e.t0=e.catch(1),console.log("cant update website");case 11:return e.abrupt("return",void 0);case 12:case"end":return e.stop()}},e,void 0,[[1,8]])})))},t.updateWebsiteEpic=function(e,t){return e.ofType(o.UPDATE_WEBSITE).switchMap((r=d(regeneratorRuntime.mark(function e(r){var n,a,i=r.payload;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.getState(),a=n.website._id,e.prev=1,e.next=4,(0,l.updateWebsite)({id:a,data:i});case 4:return e.abrupt("return",(0,o.updateWebsiteFulfilled)(i));case 7:e.prev=7,e.t0=e.catch(1),console.log("cant update website");case 10:return e.abrupt("return",void 0);case 11:case"end":return e.stop()}},e,void 0,[[1,7]])})),function(e){return r.apply(this,arguments)})).filter(Boolean);var r}}).call(this,r(380))},6651:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.undoRedoEpic=t.externalUpdateUndo=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=r(722),o=r(418),i=r(459),c=r(494),u=r(555),s=r(613),p=r(412),l=r(446),d=r(1238),f=r(962);function v(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}var g=function(e,t,r){var n=t.ignoreHistory,a=void 0!==n&&n,o=t.withoutRedo,i=void 0!==o&&o,c=v(t,["ignoreHistory","withoutRedo"]),u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return{date:Date.now(),options:u,ignoreHistory:a,withoutRedo:i,pageId:u.pageId||(0,p.getCurrentPage)(r),action:{type:e,payload:c}}},h=function(t,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=t.payload.id,c=e.get(["blocks",o])(r),u=c.anchorName,s=c.content,p=void 0===s?null:s,l=c.modifier,d=void 0===l?"":l,f=c.roles,v=c.location;return g(i.UPDATE_BLOCK,{id:o,block:n({content:p,modifier:d,anchorName:u,roles:f||[],location:v},a)},r,{location:v})};t.externalUpdateUndo=function(e){return e.ofType(s.EXTERNAL_UPDATE).map(function(){(0,f.resetUndoStack)(),(0,f.resetRedoStack)(),(0,f.notifySubs)()}).filter(Boolean)};t.undoRedoEpic=function(t,r){return o.Observable.merge(t.ofType(i.UPDATE_BLOCK,i.REMOVE_BLOCK).do(function(e){(0,f.addUndoPoint)(h(e,r.getState()))}),t.ofType((0,l.withUndoType)(i.UPDATE_BLOCK),(0,l.withUndoType)(i.REMOVE_BLOCK)).do(function(e){(0,f.addRedoPoint)(h(e,r.getState()))}),t.ofType(i.CHANGE_SORT_ORDER,(0,l.withUndoType)(i.CHANGE_SORT_ORDER)).do(function(e){var t=e.payload.id,n=r.getState().blocks,a=(0,d.sortBlocks)(n),o=a.indexOf(t),c=void 0,u=void 0;o===a.length-1?(c=a[o-1],u="after"):(c=a[o+1],u="before");var s=g(i.CHANGE_SORT_ORDER,{id:t,targetId:c,position:u},{scrollToBlockId:c});e.type===i.CHANGE_SORT_ORDER?(0,f.addUndoPoint)(s):e.type===(0,l.withUndoType)(i.CHANGE_SORT_ORDER)&&(0,f.addRedoPoint)(s)}),t.ofType((0,l.withFulfilledType)(i.CREATE_BLOCK)).do(function(e){var t=e.payload.id;(0,f.addUndoPoint)(g(i.REMOVE_BLOCK,{id:t},r.getState()))}),t.ofType(u.CHANGE_CURRENT_PRESET).do(function(e){var t=r.getState(),n=e.payload,a=n.previousSelection,o=n.id,i=t.website.uikitPalette,c={id:a,previousSelection:o,color:i.color,source:i.source};(0,f.addUndoPoint)(g(a?(0,l.extractUndoRedoActionType)(e.type):u.CHANGE_PALETTE_COLORS,c,t,{noScroll:!0}))}),t.ofType((0,l.withUndoType)(u.CHANGE_CURRENT_PRESET)).do(function(e){var t=r.getState(),n=t.website.uikitPalette,a=n.color,o=n.source,i=e.payload,c=i.previousSelection,u=i.id;(0,f.addRedoPoint)(g((0,l.extractUndoRedoActionType)(e.type),{id:c,previousSelection:u,color:a,source:o},t,{noScroll:!0}))}),t.ofType(u.CHANGE_PALETTE_COLORS).do(function(){var e=r.getState(),t=e.website.uikitPalette.color;(0,f.addUndoPoint)(g(u.CHANGE_PALETTE_COLORS,{color:t},e,{noScroll:!0}))}),t.ofType((0,l.withUndoType)(u.CHANGE_PALETTE_COLORS)).do(function(){var e=r.getState(),t=e.website.uikitPalette.color;(0,f.addRedoPoint)(g(u.CHANGE_PALETTE_COLORS,{color:t},e,{noScroll:!0}))}),t.ofType(a.LOCATION_CHANGE).map(function(e){var t=e.payload.location;return{pathname:t.pathname,state:t.state}}).distinctUntilChanged(e.isEqual).do(function(t){var r=t.pathname,n=t.state;n&&n.previewPath||(0,f.changePage)(e.pipe(e.split("/"),e.last)(r))}),t.ofType(c.CHANGE_PAGE_METADATA).do(function(t){var n=t.payload,a=n.pageId,o=n.metadata,i=r.getState(),u=e.path([a,"metadata"])(i.pages),s=e.findKey(e.path(["metadata","homepage"]),i.pages);e.pipe(e.map(e.omit(["homepage"])),e.apply(e.complement(e.equals)))([u,o])&&(0,f.addUndoPoint)(g(c.CHANGE_PAGE_METADATA,{pageId:a,metadata:u},i,{noScroll:!0,pageId:a})),o.homepage&&o.homepage!==u.homepage&&s&&(0,f.addUndoPoint)(g(c.CHANGE_PAGE_METADATA,{pageId:s,metadata:i.pages[s].metadata},i,{noScroll:!0}))}),t.ofType((0,l.withUndoType)(c.CHANGE_PAGE_METADATA)).do(function(t){var n=t.payload,a=n.pageId,o=n.metadata,i=r.getState();if(i.pages[a]){var u=e.path([a,"metadata"],i.pages),s=e.findKey(e.path(["metadata","homepage"]),i.pages);e.pipe(e.map(e.omit(["homepage"])),e.apply(e.complement(e.equals)))([u,o])&&(0,f.addRedoPoint)(g(c.CHANGE_PAGE_METADATA,{pageId:a,metadata:u},i,{noScroll:!0,pageId:a})),o.homepage&&o.homepage!==u.homepage&&s&&(0,f.addRedoPoint)(g(c.CHANGE_PAGE_METADATA,{pageId:s,metadata:i.pages[s].metadata},i,{noScroll:!0}))}}),t.ofType(c.CHANGE_PAGES_METADATA_PROP).do(function(e){var t=e.payload,a=t.value,o=v(t,["value"]);(0,f.addUndoPoint)(g(c.CHANGE_PAGES_METADATA_PROP,n({value:!a},o),r.getState(),{noScroll:!0}))}),t.ofType((0,l.withUndoType)(c.CHANGE_PAGES_METADATA_PROP)).do(function(e){var t=e.payload,a=t.value,o=v(t,["value"]);(0,f.addRedoPoint)(g(c.CHANGE_PAGES_METADATA_PROP,n({value:!a},o),r.getState(),{noScroll:!0}))}),t.ofType(i.UPDATE_TO_SOURCE).do(function(t){var n=t.payload,a=n.id,o=n.sourceId,c=r.getState(),u=e.get("blocks["+a+"].source._id",c);if(u!==o){var s=e.get("block["+u+"]",c);(0,f.addUndoPoint)(g(i.UPDATE_TO_SOURCE,{id:a,sourceId:u,sourceVersion:s},c))}}),t.ofType((0,l.withUndoType)(i.UPDATE_TO_SOURCE)).do(function(t){var n=t.payload,a=n.id,o=n.sourceId,c=r.getState(),u=e.get("blocks["+a+"].source._id",c);if(u!==o){var s=e.get("block["+u+"]",c);(0,f.addRedoPoint)(g(i.UPDATE_TO_SOURCE,{id:a,sourceId:u,sourceVersion:s},c))}}),t.ofType(c.REMOVE_PAGE).do(function(e){var t=e.payload.pageId;(0,f.filterStacks)({pageId:t})})).filter(e.F)}}).call(this,r(380))},6652:function(e,t,r){"use strict";(function(e,n){Object.defineProperty(t,"__esModule",{value:!0}),t.themesEpic=void 0;var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,a=!1,o=void 0;try{for(var i,c=e[Symbol.iterator]();!(n=(i=c.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{!n&&c.return&&c.return()}finally{if(a)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=r(418),c=r(1030),u=r(399),s=r(994),p=r(6653);function l(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function d(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(a,o){try{var i=t[a](o),c=i.value}catch(e){return void r(e)}if(!i.done)return Promise.resolve(c).then(function(e){n("next",e)},function(e){n("throw",e)});e(c)}("next")})}}t.themesEpic=function(t,r){return i.Observable.merge(t.ofType(c.FETCH_PUBLIC_THEMES).switchMap(d(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,u.getPublicThemes)();case 2:return t=e.sent,e.abrupt("return",(0,c.fetchPublicThemesFulfilledAction)({themes:t}));case 4:case"end":return e.stop()}},e,void 0)}))),t.ofType(c.FETCH_CORE_THEME).switchMap(d(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=i.Observable,e.t1=c.fetchCoreThemeFulfilledAction,e.next=4,(0,u.getCoreTheme)();case 4:if(e.t2=e.sent,e.t2){e.next=7;break}e.t2=null;case 7:return e.t3=e.t2,e.t4={theme:e.t3},e.t5=(0,e.t1)(e.t4),e.abrupt("return",e.t0.of.call(e.t0,e.t5));case 11:case"end":return e.stop()}},e,void 0)}))).switchMap(e.identity),t.ofType(c.FETCH_WEBSITE_THEME).switchMap(d(regeneratorRuntime.mark(function t(){var a,s,p,d,f;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,u.getWebsiteThemes)(e.get("website._id")(r.getState()));case 2:return a=t.sent,s=e.pipe(n.keyToProp("id"),e.sortBy(e.pipe(e.prop("createdAt"),n.construct(Date))),e.juxt([e.last,e.initial]))(a),p=o(s,2),d=p[0],f=p[1],t.abrupt("return",i.Observable.of.apply(i.Observable,[(0,c.fetchWebsiteThemeFulfilledAction)({theme:d||null})].concat(l(e.map(c.removeThemeAction,f)))));case 5:case"end":return t.stop()}},t,void 0)}))).switchMap(e.identity),t.ofType(c.USE_PUBLIC_THEME).switchMap((h=d(regeneratorRuntime.mark(function t(n){var a,o,s,p,d=n.payload.id;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=r.getState(),o=e.get("themes.websiteTheme.id")(a),s=e.get("website._id")(a),t.next=5,(0,u.createTheme)({websiteId:s,source:d});case 5:return p=t.sent,t.abrupt("return",i.Observable.of.apply(i.Observable,l(e.compact([(0,c.usePublicThemeFulfilledAction)(p),o&&(0,c.removeThemeAction)({id:o})]))));case 7:case"end":return t.stop()}},t,void 0)})),function(e){return h.apply(this,arguments)})).switchMap(e.identity),t.ofType(c.REMOVE_THEME).switchMap((g=d(regeneratorRuntime.mark(function e(t){var r,n=t.payload.id;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,u.removeTheme)(n);case 2:return r=e.sent,e.abrupt("return",(0,c.removeThemeFulfilledAction)(a({id:n},r)));case 4:case"end":return e.stop()}},e,void 0)})),function(e){return g.apply(this,arguments)})),t.ofType(c.UPDATE_THEME_TO_SOURCE).switchMap((v=d(regeneratorRuntime.mark(function e(t){var r=t.payload,n=r.id,a=r.sourceId;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=c.updateThemeToSourceFulfilledAction,e.next=3,(0,u.updateBlockToSource)({id:n,sourceId:a});case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}},e,void 0)})),function(e){return v.apply(this,arguments)})),t.ofType(c.FETCH_THEME_RENDERER).distinct(e.get("payload.viewRef")).mergeMap((f=d(regeneratorRuntime.mark(function e(t){var r,n=t.payload.viewRef;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,p.getTheme)(n);case 2:return r=e.sent,(0,s.setTheme)(n,r),e.abrupt("return",(0,c.fetchThemeRendererFulfilledAction)({viewRef:n}));case 5:case"end":return e.stop()}},e,void 0)})),function(e){return f.apply(this,arguments)})));var f,v,g,h}}).call(this,r(380),r(391))},6653:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getTheme=void 0;var n=r(2274),a=function(e){if("weblium/editor"===e)return r(2621);throw new Error("Invalid required path "+e)};t.getTheme=function(e){return(0,n.buildTheme)({viewRef:e,requireInjector:a})}},6654:function(e,t,r){"use strict";(function(e,n){Object.defineProperty(t,"__esModule",{value:!0}),t.modalsEpic=void 0;var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=r(418),i=r(611),c=r(398),u=r(148);t.modalsEpic=function(t){return o.Observable.merge(t.filter(e.propSatisfies("type",n.anyPass([n.endsWith("@UNDO_PROCEED"),n.endsWith("@REDO_PROCEED")]))).mergeMap(function(){return o.Observable.of((0,i.closeAllModalsAction)())}),t.ofType(i.CLOSE_ALL_MODALS).mergeMap(function(){var e=(n.filter("hash",(0,c.getOpenedModals)())[0]||{}).hash,t=(0,u.getHistory)();return t.location.hash===e&&t.push(a({},t.location,(0,c.getSavedLocation)())),o.Observable.of((0,i.closeAllModalsActionFulfilled)())}))}}).call(this,r(391),r(380))},6655:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.commentsEpic=void 0;var n=r(418),a=r(1029),o=r(399);function i(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(a,o){try{var i=t[a](o),c=i.value}catch(e){return void r(e)}if(!i.done)return Promise.resolve(c).then(function(e){n("next",e)},function(e){n("throw",e)});e(c)}("next")})}}var c=function(t){return function(r){return r?e.update("block.ref",t)(r):r}};t.commentsEpic=function(t,r){return n.Observable.merge(t.ofType(a.FETCH_COMMENTS).switchMap((v=i(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.payload.websiteId,e.prev=1,e.next=4,(0,o.fetchComments)(r);case 4:return n=e.sent,e.abrupt("return",(0,a.fetchCommentsFulfilledAction)(n));case 8:return e.prev=8,e.t0=e.catch(1),console.log(e.t0),e.abrupt("return",(0,a.fetchCommentsFulfilledAction)([]));case 12:case"end":return e.stop()}},e,void 0,[[1,8]])})),function(e){return v.apply(this,arguments)})),t.ofType(a.ADD_COMMENT_CONFIRM).mergeMap((f=i(regeneratorRuntime.mark(function t(n){var i,u,s,p,l,d,f,v,g;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=n.payload,u=i.comment,s=i.tempId,p=r.getState(),l=p.website._id,d=p.blocks,f=e.flow(e.omit(["id","active","pinNumber"]),e.update("location",c(function(e){return e?e._id:e})))(u),t.prev=3,t.next=6,(0,o.addComment)({comment:f,websiteId:l});case 6:return v=t.sent,g=e.update("location",c(function(t){return{_id:t,roles:e.getOr([],t+".roles")(d)}}))(v),t.abrupt("return",(0,a.addCommentConfirmFulfilledAction)(s,g));case 11:return t.prev=11,t.t0=t.catch(3),t.abrupt("return",(0,a.addCommentConfirmRejectAction)(s));case 14:case"end":return t.stop()}},t,void 0,[[3,11]])})),function(e){return f.apply(this,arguments)})),t.ofType(a.ADD_AND_POST_COMMENT).mergeMap((d=i(regeneratorRuntime.mark(function t(n){var i,u,s,p,l,d,f,v,g,h,m;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=n.payload,u=i.comment,s=i.commentToPost,p=r.getState(),l=p.website._id,d=p.blocks,f=s.id,v=s.tempId,g=e.flow(e.omit(["id","tempId","inProgress","active","pinNumber"]),e.update("location",c(function(e){return e?e._id:e})))(s),t.prev=4,t.next=7,(0,o.addComment)({comment:g,websiteId:l});case 7:return h=t.sent,m=e.update("location",c(function(t){return{_id:t,roles:e.getOr([],t+".roles")(d)}}))(h),t.abrupt("return",(0,a.addAndPostCommentFulfilledAction)(u,m,v));case 12:return t.prev=12,t.t0=t.catch(4),t.abrupt("return",(0,a.addCommentConfirmRejectAction)(f));case 15:case"end":return t.stop()}},t,void 0,[[4,12]])})),function(e){return d.apply(this,arguments)})),t.ofType(a.UPDATE_COMMENT).mergeMap((l=i(regeneratorRuntime.mark(function t(n){var i,c,u,s,p,l,d;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(i=n.payload,c=i.id,u=i.comment,s=i.newId,!u.inProgress){t.next=3;break}return t.abrupt("return",(0,a.updateCommentFulfilledAction)(c,u,s));case 3:return t.prev=3,p=e.flow(e.pick(["location","text"]),e.update("location.block.ref",function(e){return e?e._id:e}))(u),l=r.getState(),d=l.website._id,t.next=8,(0,o.updateComment)({id:c,data:p,websiteId:d});case 8:return t.abrupt("return",(0,a.updateCommentFulfilledAction)(c,u));case 11:t.prev=11,t.t0=t.catch(3),console.log("comment update error",t.t0);case 14:case"end":return t.stop()}},t,void 0,[[3,11]])})),function(e){return l.apply(this,arguments)})).filter(Boolean),t.ofType(a.RESOLVE_COMMENT).mergeMap((p=i(regeneratorRuntime.mark(function t(n){var i,c,u,s,p;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(i=n.payload.id,c=r.getState(),u=c.website._id,s=r.getState(),p=s.comments,!e.find(function(e){return e.id===i})(p)){t.next=14;break}return t.prev=5,t.next=8,(0,o.resolveComment)({id:i,websiteId:u});case 8:return t.abrupt("return",(0,a.resolveCommentFulfilledAction)(i));case 11:t.prev=11,t.t0=t.catch(5),console.log("comment resolve error",t.t0);case 14:case"end":return t.stop()}},t,void 0,[[5,11]])})),function(e){return p.apply(this,arguments)})).filter(Boolean),t.ofType(a.UNRESOLVE_COMMENT).mergeMap((s=i(regeneratorRuntime.mark(function t(n){var i,c,u,s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(i=n.payload.id,c=r.getState(),u=c.comments,s=c.website._id,!e.find(function(e){return e.id===i})(u)){t.next=7;break}return t.next=6,(0,o.unresolveComment)({id:i,websiteId:s});case 6:return t.abrupt("return",(0,a.unresolveCommentFulfilledAction)(i));case 7:case"end":return t.stop()}},t,void 0)})),function(e){return s.apply(this,arguments)})).filter(Boolean),t.ofType(a.REMOVE_COMMENT).mergeMap((u=i(regeneratorRuntime.mark(function e(t){var n,i,c,u,s,p,l,d,f,v;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=r.getState(),i=n.website._id,c=t.payload.ids,u=Array.isArray(c)?c:[c],e.prev=3,s=!0,p=!1,l=void 0,e.prev=7,d=u[Symbol.iterator]();case 9:if(s=(f=d.next()).done){e.next=16;break}return v=f.value,e.next=13,(0,o.removeComment)({id:v,websiteId:i});case 13:s=!0,e.next=9;break;case 16:e.next=22;break;case 18:e.prev=18,e.t0=e.catch(7),p=!0,l=e.t0;case 22:e.prev=22,e.prev=23,!s&&d.return&&d.return();case 25:if(e.prev=25,!p){e.next=28;break}throw l;case 28:return e.finish(25);case 29:return e.finish(22);case 30:return e.abrupt("return",(0,a.removeCommentFulfilledAction)(u));case 33:e.prev=33,e.t1=e.catch(3),console.log("remove error",e.t1);case 36:case"end":return e.stop()}},e,void 0,[[3,33],[7,18,22,30],[23,,25,29]])})),function(e){return u.apply(this,arguments)})).filter(Boolean));var u,s,p,l,d,f,v}}).call(this,r(380))},6656:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.editorStatusEpic=t.SAVING_ACTIONS=void 0;var n=r(1027),a=r(1234),o=r(446),i=r(418),c=r(459),u=r(494),s=r(555);var p=t.SAVING_ACTIONS=[c.UPDATE_BLOCK,c.CREATE_BLOCK,c.REMOVE_BLOCK,c.CHANGE_SORT_ORDER,c.UPDATE_TO_SOURCE,u.CHANGE_PAGE_METADATA,u.CHANGE_PAGES_METADATA_PROP,u.REMOVE_PAGE,s.CHANGE_CURRENT_PRESET,s.CHANGE_PALETTE_COLORS,u.CREATE_PAGE,s.CHANGE_CURRENT_TYPOGRAPHY,s.CHANGE_TYPOGRAPHY_SETTINGS,s.CHANGE_CURRENT_BUTTON_PRESET,s.CHANGE_BUTTON_SETTINGS],l=p.map(function(e){return(0,o.withFulfilledType)(e)});t.editorStatusEpic=function(t){return i.Observable.merge(t.ofType.apply(t,p).do(function(e){var t=e.type,r=e.payload;(0,n.changeEditorStatus)(a.SAVING,{type:t,payload:r})}),t.ofType.apply(t,function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(l)).do(function(){[a.READY,a.LOADING].includes((0,n.getEditorStatus)())||(0,n.changeEditorStatus)(a.SAVED)}),t.ofType((0,o.withPermissionType)(u.READY_PAGE)).do(function(){(0,n.changeEditorStatus)(a.READY)})).filter(e.F)}}).call(this,r(380))},6657:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchOrganizationEpic=void 0;var n=r(577),a=r(1270);t.fetchOrganizationEpic=function(e){return e.ofType(a.FETCH_ORGANIZATION).distinctUntilChanged(function(e,t){return e.id===t.id}).switchMap((t=regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=void 0,e.prev=1,e.next=4,(0,n.getUserOrganizationsList)();case 4:if(!(r=e.sent).length){e.next=9;break}t=r[0],e.next=12;break;case 9:return e.next=11,(0,n.getOrganizationInfo)();case 11:t=e.sent;case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(1),console.error("Couldn't get user organization info",e.t0),t={};case 18:return e.abrupt("return",(0,a.fetchOrgFulfilledAction)(t||{}));case 19:case"end":return e.stop()}},e,void 0,[[1,14]])}),function(){var e=t.apply(this,arguments);return new Promise(function(t,r){return function n(a,o){try{var i=e[a](o),c=i.value}catch(e){return void r(e)}if(!i.done)return Promise.resolve(c).then(function(e){n("next",e)},function(e){n("throw",e)});t(c)}("next")})}));var t}},6658:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchPopupTemplatesEpic=void 0;var n=r(418),a=r(1512),o=r(399),i=t.fetchPopupTemplatesEpic=function(e){return e.ofType(a.FETCH_POPUP_TEMPLATES).mergeMap(function(e){var t=e.payload.filter;return n.Observable.fromPromise((0,o.getBlockTemplates)(t)).map(function(e){return(0,a.fetchPopupTemplatesFulfilledAction)({popupTemplates:e})})})};t.default=i}}]);